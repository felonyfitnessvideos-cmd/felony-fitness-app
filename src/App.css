/**
 * @file App.css
 * @description The root stylesheet for the main App component.
 * @project Felony Fitness
 *
 * @layout_pattern App Shell Layout
 * This file defines the primary layout for the application, often called an "App Shell".
 * - The `.app-container` uses a flexbox column to stack the main content and the navbar.
 * - The `.main-content` area is configured to grow and fill all available space,
 * with its own independent scrolling. This is a crucial pattern for mobile app layouts,
 * as it allows the content of each page to scroll while the navigation bar remains fixed.
 * - The `.bottom-nav` is positioned absolutely at the bottom of the screen, providing
 * persistent navigation.
 */

/**
 * The main container for the entire app screen.
 * It establishes the flexbox context for its direct children.
 */
.app-container {
  display: flex;
  height: 100%; /* Ensures the app fills the full viewport height */
  width: 100%;
  background-color: var(--background-color);
}

/* Mobile layout: vertical stack with bottom navigation */
.app-container.mobile-layout {
  flex-direction: column; /* Stacks children vertically (main content on top, nav on bottom) */
}

/* Desktop layout: horizontal with sidebar */
.app-container.desktop-layout {
  flex-direction: row; /* Side-by-side layout */
  flex-wrap: nowrap; /* Prevent wrapping to new lines */
  min-height: 100vh;
  position: relative;
}

/**
 * The primary content area for all pages.
 * 
 * This is where the `<Outlet />` from React Router renders its content.
 * 
 * @layout_pattern App Shell Layout
 * - Uses flexbox to grow and fill available vertical space
 * - Independent scrolling container for page content
 * - Bottom padding accounts for fixed navigation bar
 * 
 * @scrolling_behavior
 * - `overflow-y: auto` - Enables vertical scrolling when content exceeds container height
 * - Scrollbar hidden via CSS for clean, native-app-like appearance
 * - Smooth scrolling enabled on supporting browsers
 * 
 * @safe_area_handling
 * - Bottom padding calculation: 60px (nav height) + env(safe-area-inset-bottom) + 0.5rem (breathing room)
 * - MUST stay synchronized with `.bottom-nav` height and safe area handling
 * - iOS: Accounts for home indicator area (34px on iPhone X and newer)
 * - Android: Accounts for gesture navigation bar (varies by device, typically 20-48px)
 * - Prevents content from being hidden behind bottom navigation
 * - Ensures last element in scrollable content is always accessible
 * - Requires `viewport-fit=cover` in index.html meta viewport tag
 * 
 * @mobile_optimization
 * - Full safe area support for iOS and Android
 * - Touch scrolling optimized via -webkit-overflow-scrolling
 * - Works with both gesture navigation and traditional button navigation
 * 
 * @previous_issues
 * - Fixed 2025-11-20: Updated to match bottom-nav safe area handling for iOS and Android
 * - Related issue: Bottom nav disappearing behind phone UI elements
 * 
 * @desktop_override
 * - Desktop layout removes extra bottom padding (no bottom nav present)
 * - See `.app-container.desktop-layout .main-content` override at bottom of file
 * 
 * @related_components
 * - `.bottom-nav` - Fixed navigation bar this padding accounts for
 * - `.app-container.desktop-layout` - Alternative layout without bottom nav
 * - index.html: Requires `viewport-fit=cover` meta tag
 * 
 * @testing_checklist
 * - [ ] Scroll to bottom of long pages - last element should be fully visible
 * - [ ] Verify content doesn't overlap bottom navigation
 * - [ ] Test on iOS devices with home indicator
 * - [ ] Test on Android devices with gesture navigation (Pixel, Samsung, OnePlus)
 * - [ ] Test on Android devices with traditional nav buttons
 * - [ ] Verify desktop layout doesn't have unnecessary bottom padding
 * - [ ] Test in Chrome DevTools device emulation
 */
.main-content {
  flex-grow: 1; /* This is the key property: it tells this element to "grow" and fill all available vertical space not taken by the navbar. */
  flex-shrink: 1; /* Allow content to shrink if needed */
  min-width: 0; /* Allow content to shrink below its intrinsic width */
  overflow-y: auto; /* Enables vertical scrolling ONLY when the content is taller than the container. */
  /* Ensure content can scroll above the fixed bottom nav. Add extra bottom padding to keep actions visible. */
  padding-bottom: calc(60px + env(safe-area-inset-bottom, 0px) + 0.5rem);

  /* The following rules hide the scrollbar for a cleaner, more native-app-like feel. */
  -ms-overflow-style: none; /* For Internet Explorer and Edge */
  scrollbar-width: none; /* For Firefox */
}
/* For Chrome, Safari, and other WebKit browsers */
.main-content::-webkit-scrollbar {
  display: none;
}

/**
 * The bottom navigation bar.
 * 
 * CRITICAL: This component must account for mobile device safe areas (iOS home indicator, Android gesture navigation)
 * to prevent the navigation from being hidden behind phone UI elements.
 * 
 * @positioning
 * - `position: absolute` - Fixed at bottom of screen across all pages
 * - `bottom: 0` - Anchored to viewport bottom
 * - `z-index: 100` - High z-index ensures it sits on top of page content but below modals
 * 
 * @safe_area_handling
 * - Base height: 60px (visible navigation content)
 * - Additional padding-bottom: env(safe-area-inset-bottom) for device-specific bottom insets
 * - iOS: Handles home indicator area (34px on iPhone X and newer)
 * - Android: Handles gesture navigation bar (varies by device, typically 20-48px)
 * - MUST use `padding-bottom` NOT `height` to extend clickable area below visible content
 * - This ensures nav icons remain above phone UI while extending into safe area
 * - Requires `viewport-fit=cover` in index.html meta viewport tag
 * 
 * @previous_issues
 * - Fixed 2025-11-20: Bottom nav disappearing behind iOS home indicator and Android gesture bar
 * - Root cause: Missing safe-area-inset-bottom in padding calculation
 * - Impact: Navigation icons were partially or fully obscured on iPhone X+ and Android with gesture nav
 * 
 * @related_components
 * - `.main-content` uses matching safe-area calculation for scroll padding
 * - Fixed footers (e.g., `.calorie-status-footer`) must position above this element
 * - index.html: Requires `viewport-fit=cover` meta tag
 * 
 * @testing_checklist
 * - [ ] Test on iPhone with home indicator (X, 11, 12, 13, 14, 15, 16)
 * - [ ] Test on Android devices with gesture navigation (Pixel, Samsung, OnePlus)
 * - [ ] Test on Android devices with traditional nav buttons
 * - [ ] Verify nav icons are fully clickable and visible
 * - [ ] Check that no content is hidden behind nav on any page
 * - [ ] Test in Chrome DevTools device emulation
 * - [ ] Verify safe area works in both portrait and landscape
 * 
 * @see {@link https://webkit.org/blog/7929/designing-websites-for-iphone-x/}
 * @see {@link https://developer.mozilla.org/en-US/docs/Web/CSS/env}
 * @see `.main-content` for related safe area handling
 */
.bottom-nav {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  display: flex;
  justify-content: space-around; /* Distributes nav links evenly */
  background-color: var(--card-color);
  border-top: 1px solid var(--border-color);
  padding: 0.5rem 0;
  /* âœ… CRITICAL FIX: Add safe-area-inset-bottom to padding to prevent iOS home indicator and Android gesture bar from hiding navigation */
  padding-bottom: calc(0.5rem + env(safe-area-inset-bottom, 20px));
  height: 60px; /* A fixed height is important for layout consistency - does NOT include safe area */
  z-index: 100; /* A high z-index ensures it sits on top of page content */
}

/**
 * Individual navigation links within the bottom bar.
 */
.nav-link {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  flex: 1; /* Ensures each link takes up an equal amount of horizontal space */
  text-decoration: none;
  color: var(--text-secondary);
  transition: color 0.2s; /* Smooth color transition on state change */
}

.nav-link span {
  font-size: 0.75rem;
  margin-top: 4px;
}

/**
 * The style applied by React Router's <NavLink> to the currently active link.
 * This provides a clear visual indicator of the user's location in the app.
 */
.nav-link.active {
  color: var(--accent-color);
}

/**
 * Sidebar Navigation (Desktop/Tablet)
 */
.sidebar-nav {
  width: 220px; /* Narrower for tablet compatibility */
  min-width: 220px;
  background-color: var(--card-color);
  border-right: 1px solid var(--border-color);
  display: flex;
  flex-direction: column;
  height: 100%;
  flex-shrink: 0; /* Prevent sidebar from shrinking */
  box-sizing: border-box;
}

/* Wider sidebar on larger screens */
@media (min-width: 1024px) {
  .sidebar-nav {
    width: 280px;
    min-width: 280px;
  }
}

.sidebar-header {
  padding: 2rem 1.5rem 1rem;
  border-bottom: 1px solid var(--border-color);
}

.sidebar-header h2 {
  color: var(--accent-color);
  font-size: 1.5rem;
  font-weight: 700;
  margin: 0;
}

.sidebar-links {
  flex: 1;
  padding: 1.5rem 0;
}

.sidebar-link {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 0.875rem 1.5rem;
  color: var(--text-secondary);
  text-decoration: none;
  transition: all 0.2s ease;
  border-right: 3px solid transparent;
}

.sidebar-link:hover {
  background-color: var(--hover-color);
  color: var(--text-primary);
}

.sidebar-link.active {
  background-color: rgba(249, 115, 22, 0.1);
  color: var(--accent-color);
  border-right-color: var(--accent-color);
}

.sidebar-link span {
  font-weight: 500;
  font-size: 0.95rem;
}

/* Responsive adjustments for desktop layout */
.app-container.desktop-layout .main-content {
  padding-bottom: 1rem; /* Remove extra bottom padding since no bottom nav */
}
